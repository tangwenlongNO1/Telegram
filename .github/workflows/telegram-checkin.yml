name: Telegram Checkin

# 触发条件：定时执行 + 手动触发
on:
  schedule:
    # 每天 UTC 时间 00:00 执行（北京时间 08:00）
    # 格式：分 时 日 月 周
    - cron: '0 0 * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  checkin:
    runs-on: ubuntu-latest
    
    steps:
      - name: 发送 /checkin 指令
        env:
          # 从仓库 secrets 中获取环境变量
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # 使用 curl 发送 HTTP 请求
          curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
            -d "chat_id=$CHAT_ID" \
            -d "text=/checkin"
          
          # 检查请求是否成功
          if [ $? -eq 0 ]; then
            echo "✅ /checkin 指令发送成功"
          else
            echo "❌ /checkin 指令发送失败"
            exit 1
          fi
